{# branches/templates/branches/manager/_daysheet_panel.html #}
<section id="tab-sheets" class="tab-panel hidden">
<div class="bg-white rounded-xl p-5 shadow-sm border space-y-6">

  <!-- Header -->
  <div class="flex items-start justify-between">
    <div>
      <h3 class="text-lg font-semibold text-slate-800">
        Day Sheet — {{ todays_sheet.date|default:"Today" }}
      </h3>
      <p class="text-xs text-slate-500">
        Status: <span class="font-medium">{{ todays_sheet.status|default:"open" }}</span>
      </p>
    </div>

    <div class="flex items-center gap-2">

      <button id="btnLockSheet"
        class="px-3 py-2 rounded-md bg-white border text-sm hover:bg-slate-50">
        Lock / Unlock
      </button>

      <button id="btnCloseDay"
        class="px-4 py-2 rounded-md bg-red-600 text-white text-sm hover:bg-red-700">
        Close Day
      </button>
    </div>
  </div>

  <!-- Financial Summary -->
  <div class="grid grid-cols-1 sm:grid-cols-5 gap-4">

    <div class="p-3 bg-slate-50 rounded">
      <div class="text-xs text-slate-500">Total Jobs</div>
      <div class="text-xl font-semibold">{{ todays_sheet.total_jobs|default:0 }}</div>
    </div>

    <div class="p-3 bg-slate-50 rounded">
      <div class="text-xs text-slate-500">Total Collected</div>
      <div class="text-xl font-semibold">
        GHS {{ todays_sheet.total_amount|default:"0.00" }}
      </div>
    </div>

    <div class="p-3 bg-amber-50 rounded border border-amber-200">
      <div class="text-xs text-amber-700">Deposits Received</div>
      <div class="text-xl font-semibold text-amber-800">
        GHS {{ todays_sheet.deposits_total|default:"0.00" }}
      </div>
    </div>

    <div class="p-3 bg-amber-50 rounded border border-amber-200">
      <div class="text-xs text-amber-700">Outstanding Balance</div>
      <div class="text-xl font-semibold text-amber-800">
        GHS {{ todays_sheet.pending_amount|default:"0.00" }}
      </div>
    </div>

    <div class="p-3 bg-slate-100 rounded">
      <div class="text-xs text-slate-500">Net Completed Revenue</div>
      <div class="text-xl font-semibold">
        GHS {{ todays_sheet.completed_amount|default:"0.00" }}
      </div>
    </div>

  </div>

  <!-- Shifts -->
  <div>
    <h4 class="text-sm font-semibold mb-2 text-slate-700">
      Attendant Shifts
    </h4>

    <div class="overflow-auto border rounded-lg">
      <table class="w-full text-sm">
        <thead class="bg-slate-50 text-slate-500 text-left">
          <tr>
            <th class="px-3 py-2">Attendant</th>
            <th class="px-3 py-2">Start</th>
            <th class="px-3 py-2">End</th>
            <th class="px-3 py-2">Deposits</th>
            <th class="px-3 py-2">Collected</th>
            <th class="px-3 py-2">Status</th>
            <th class="px-3 py-2">Action</th>
          </tr>
        </thead>

        <tbody id="shiftsTbody">
          {% if recent_shifts %}
            {% for s in recent_shifts %}
              <tr class="border-t">
                <td class="px-3 py-2">{{ s.user_name }}</td>
                <td class="px-3 py-2">{{ s.shift_start }}</td>
                <td class="px-3 py-2">{{ s.shift_end|default:"—" }}</td>
                <td class="px-3 py-2 text-amber-700">
                  GHS {{ s.deposit_total|default:"0.00" }}
                </td>
                <td class="px-3 py-2">
                  GHS {{ s.collected_total|default:"0.00" }}
                </td>
                <td class="px-3 py-2">
                  <span class="text-xs px-2 py-1 rounded bg-slate-100">
                    {{ s.status }}
                  </span>
                </td>
                <td class="px-3 py-2">
                  {% if s.can_close %}
                    <button
                      data-shift="{{ s.id }}"
                      class="btn-close-shift text-xs px-2 py-1 rounded border bg-white hover:bg-slate-50">
                      Close Shift
                    </button>
                  {% else %}
                    <span class="text-xs text-slate-400">—</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="7" class="px-3 py-6 text-center text-slate-500">
                No shifts recorded yet
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Audit / Notes -->
  <div class="bg-slate-50 rounded p-3 text-xs text-slate-600">
    <strong>Notes / Audit</strong><br>
    {% if todays_sheet_obj %}
      {{ todays_sheet_obj.meta|default:"No notes recorded." }}
    {% else %}
      Sheet metadata will appear here after reconciliation.
    {% endif %}
  </div>

</div>
</section>